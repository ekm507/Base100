# Base 100 coding
# urlcode — تبدیل لینک/متن به کد عددی دو رقمی (قابل خواندن تلفنی) + چک‌سام + Repair

`urlcode` یک ابزار خط فرمان است که متن (مثل لینک) را به یک رشته‌ی فقط-عدد تبدیل می‌کند که از **گروه‌های دو رقمی (00..99)** تشکیل شده است تا بتوانید پشت تلفن بخوانید و طرف مقابل تایپ کند.  
این ابزار همچنین **چک‌سام بلوکی** و یک **چک‌سام نهایی قوی (SHA-256)** دارد و در صورت خطا می‌تواند تا حدی **Repair (اصلاح با brute-force محدود)** انجام دهد.

> نکته: تمام تنظیمات لازم برای decode داخل خود کد ذخیره می‌شود (self-describing). پس گیرنده برای decode نیاز به هیچ پارامتری ندارد.

---

## نصب

### ساخت باینری
```bash
go build -o urlcode main.go
````

### اجرا

```bash
./urlcode --help
./urlcode encode --help
./urlcode decode --help
```

---

## ایده‌ی کلی

* خروجی یک رشته‌ی عددی است که می‌توان آن را با فاصله/خط/خط‌تیره هم چاپ کرد (در حالت `--pretty`).
* داده به base-100 تبدیل می‌شود (هر گروه 2 رقمی معادل یک رقم base100).
* داده‌ها به **بلوک‌ها** تقسیم می‌شوند:

  * هر بلوک شامل `BD` گروه داده است (مثلاً 5 یا 10)
  * و بعد از آن `BC` گروه چک‌سام بلوکی اضافه می‌شود (مثلاً 1 یا 2)
* در انتها (اختیاری)، یک چک‌سام نهایی بر اساس **SHA-256** می‌آید که قدرتش با `--final-bytes` قابل تنظیم است.

---

## Encode (متن → کد)

### مثال پایه (پیشنهادی برای تلفن)

```bash
./urlcode encode --text "https://example.com/a?b=1&c=2" \
  --block-data-groups 5 \
  --block-check-groups 2 \
  --final-bytes 8 \
  --pretty
```

* `--block-data-groups` (BD): تعداد گروه‌های داده در هر بلوک (مثلاً 5)
* `--block-check-groups` (BC): تعداد گروه‌های چک‌سام بلوک (مثلاً 2)
* `--final-bytes`: تعداد بایت‌های چک‌سام نهایی (0 تا 32)

  * `0` یعنی چک‌سام نهایی خاموش
  * `8` یا `12` معمولاً تعادل خوبی بین طول و امنیت/اطمینان است
* `--pretty`: خروجی را بلوک‌بندی و شماره‌دار می‌کند (برای کاهش خطا عالی است)

### خواندن از stdin

```bash
echo "https://example.com/..." | ./urlcode encode \
  --block-data-groups 5 --block-check-groups 2 --final-bytes 8 --pretty
```

---

## Decode (کد → متن)

### decode ساده

```bash
./urlcode decode --code "...."
```

### decode با چاپ زیبا

```bash
./urlcode decode --code "...." --pretty
```

> decode تنظیمات بلوک/چک‌سام را از Header داخل کد می‌خواند؛ نیازی نیست شما چیزی بدهید.

### اگر می‌خواهید چک‌سام‌ها را فعلاً نادیده بگیرید (توصیه نمی‌شود)

```bash
./urlcode decode --code "...." --no-check
```

---

## Repair (تلاش برای اصلاح خطاهای تایپی)

اگر موقع تایپ چند عدد اشتباه وارد شده باشد، می‌توانید از `--repair` استفاده کنید.
این گزینه تلاش می‌کند با تغییر دادن **۱ تا N گروه دو رقمی** (00..99) کد را طوری اصلاح کند که چک‌سام‌ها درست شوند.

### Repair پیشنهاد‌شده (هدفمند)

```bash
./urlcode decode --code "...." --repair 1 --pretty
```

* `--repair 1` یعنی یک خطای تایپی (یک گروه) را سعی می‌کند اصلاح کند.
* اگر احتمال می‌دهید در یک بلوک چند اشتباه رخ داده:

```bash
./urlcode decode --code "...." --repair 2 --pretty
```

### Repair scope (تعیین اینکه کجاها اجازه‌ی تغییر داریم)

```bash
./urlcode decode --code "...." --repair 2 --repair-scope auto --pretty
```

Scope ها:

* `auto` (پیش‌فرض): اگر بلوک خراب باشد فقط همان بلوک‌ها؛ اگر فقط final خراب باشد فقط final
* `bad`: فقط بلوک‌های خراب
* `all`: کل پیام (سنگین‌تر)
* `final`: فقط چک‌سام نهایی
* `blocks:3,7,8`: فقط بلوک‌های مشخص

### Guided repair (پیش‌فرض روشن)

`--repair-guided=true` (پیش‌فرض) معمولاً بهترین عملکرد را دارد چون اول بلوک‌های خراب را پیدا می‌کند و اصلاح را محدود می‌کند.
اگر می‌خواهید brute-force سراسری داشته باشید:

```bash
./urlcode decode --code "...." --repair 2 --repair-guided=false --repair-scope all
```

### ابهام (ambiguous)

گاهی ممکن است چند اصلاح مختلف چک‌سام را درست کنند. در این حالت برنامه چند کاندید چاپ می‌کند و با exit code غیر صفر خارج می‌شود.

---

## نکته‌های عملی برای انتقال تلفنی

* همیشه از `--pretty` استفاده کنید تا بلوک‌ها شماره‌دار باشند.
* بلوک‌ها را خط به خط بخوانید (مثلاً: «بلوک ۰۳: ...»).
* طرف مقابل بعد از هر بلوک می‌تواند چک‌سام همان بلوک را تایپ کند تا اشتباه همانجا مشخص شود.
* برای اطمینان بیشتر `--final-bytes` را بالاتر ببرید (مثلاً 12 یا 16).

---

## Exit codes

* `0` موفق (encode/decode درست)
* `1` خطا در decode/encode/repair یا ambiguous repair
* `2` خطای پارامترهای CLI / ورودی نامعتبر
